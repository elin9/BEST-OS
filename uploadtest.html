
<!DOCTYPE html>

<html>
<head>
<title>upload</title>
<script src="http://elin9.rochestercs.org/jquery-1.11.0.js"></script>
<script src="http://malsup.github.com/jquery.form.js"></script> 

<script type="text/javascript">
   function previewFile(){
       var preview = document.querySelector('img'); //selects the query named img
       var file    = document.querySelector('input[type=file]').files[0]; //sames as here
       var reader  = new FileReader();

       reader.onloadend = function () {
           preview.src = reader.result;
       }

       if (file) {
           reader.readAsDataURL(file); //reads the data as a URL
       } else {
           preview.src = "";
       }
  }

  previewFile();  //calls the function named previewFile()
  
  
  $(document).ready(function() {
  console.log("Loaded!");
  
  $('#upload').ajaxForm(function() { 
  
      var file = $('#upload').find('input[name="img"]').val();
      var txt = $('#upload').find('input[name="txt"]').val();

      $.ajax(
      {
        url: "cgi-bin/imgupload.py",
        type: "POST",
        dataType: "text",
        data: {file:file, txt:txt},

        success: function(data) {
          console.dir(data);
          $("#uh").append(data);
          console.log("image posted!");
        },
      }
    );
  });
}

</script>
</head>
<body>
<form enctype="multipart/form-data" id = "upload">
<input type = "file" name = "img" onchange = "previewFile()"><br>
<input type = "text" name = "txt"><br>
<input type = "submit" value = "Submit">
</form>
<img src="" height="200" alt="Image preview...">
<div id = "uh"></div>
</body>
</html>